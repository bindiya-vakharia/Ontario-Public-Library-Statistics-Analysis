# Ontario Public Library Statistics Analysis

### Table of Contents
- [Data Source](#data-source)
- [Data Preparation](#data-preparation)
- [Project Overview](#project-overview)
- [Build with](build-with)
- [ERD Diagram](erd-diagram)

### Data Source
---
The data for this analysis is [Ontario-Public-Library-Statistics-Analysis_open_data1.csv](https://github.com/bindiya-vakharia/Ontario-Public-Library-Statistics-Analysis/blob/main/ontario_public_library_statistics_2022_open_data1.csv) containing Ontario Public Library Statistics 2022 from the Open Ontario website.

### Data Preparation
---
- The data was primarily cleaned and checked for missing values in Excel.
- Then, the data was imported to pgAdmin using the ERD tool in PostgreSQL for further analysis.

### Project Overview
 ---
This SQL project is about a detailed library management analysis of the database for the Ontario Public Library Statistics-2022. The entire case study looks at the processes and outputs generated by running complex SQL queries to find meaningful insights from the data.

### Build with
- SQL Language
  - PostgreSQL

- Tools
  - pgAdmin

### ERD Diagram
---
![image](https://github.com/bindiya-vakharia/Ontario-Public-Library-Statistics-Analysis-/assets/161663134/adafd32b-0126-4b51-a0f3-35ddf4421abd)

### Objectives and Goals
---
Extract insights about the number of cardholders, catalogue items, and funding received by libraries to identify one library with the highest number of active cardholders, libraries with at least 100,000 active cardholders, items in the catalogue and the amount of local and provincial funding received by the Public or Union Libraries that fall under Southern Ontario Library Service region.

### Queries
---

1. How many libraries have at least 100,000 active cardholders, and where are they situated?

The names of all the libraries that have at least 100,000 cardholders were selected, and the results were displayed by showing the libraries with the highest active cardholders first.
```sql
SELECT library_name, active_cardholder, city
FROM libraries as lib
INNER JOIN locations as l
ON lib.location_id = l.location_id
WHERE active_cardholder IN (
SELECT active_cardholder
FROM libraries
WHERE active_cardholder >= 100000)
ORDER BY active_cardholder DESC;
```
##### Insights
- 8 libraries have more than 100,000 active cardholders.
- Toronto Public Library has the highest number of cardholders, followed by Ottawa.
- The Library of Brampton ranks 8th in the 100000 active cardholders category.

2. How many products from the catalogue do the libraries with at least 100,000 active cardholders offer to those visiting the library?

The library number, library name and the sum of printed books, eBooks, audiobooks, and CD & DVDs held by the libraries were selected and the results were displayed of only those libraries which had at least 100,000 active cardholders.

```sql
SELECT l.library_number, c.library_name, SUM(c.print_title + c.print_volume) as total_prinbooks_held,
SUM(c.ebook_title + c.ebook_copy) as total_ebooks_held,
SUM(c.audiobook_title + c.audiobook_copy) as total_audiobooks_held,
SUM(c.cd_dvd_title + c.cd_dvd_copy) as total_cd_dvds_held
FROM catalogues as c
INNER JOIN  libraries as l
ON c.library_name = l.library_name
WHERE c.library_name IN ('Toronto','Ottawa','London','Mississauga','Hamilton','Burlington','Markham','Brampton')
GROUP BY c.library_name, l.library_number;
```
##### Insights
- Toronto library has the highest number of all the items in the catalogue.
- The library in Burlington holds the least number of items in the catalogue.

3. How many cardholders are there in each library?

The library names of all libraries were selected. Then a new column called ‘range_cardholder’ is there in each library and grouped the results are into the following groups: High, Medium, Very Low and No active cardholders.

```sql
SELECT library_name,
CASE 
WHEN active_cardholder >= 100000 THEN 'High'
WHEN active_cardholder BETWEEN 50000 AND 100000 THEN 'Medium'
WHEN active_cardholder BETWEEN 10000 AND 50000 THEN 'Low'
WHEN active_cardholder BETWEEN 1 AND 10000 THEN 'Very Low'
ELSE 'No cardholders'
END AS cardholder_range
FROM libraries
ORDER BY active_cardholder DESC;
```

##### Insights
- There are 65 libraries which doesn’t have any active cardholders.
- There are 8 libraries with High number of active cardholders, 10 libraries with active cardholders in the range of 50,000 and 100,000, 42 libraries with active cardholders in the range of 10,000 and 50,000 and 239 libraries with active cardholders in the range of 1 to 10,000.

4. What is the total number of provincial and local funding received by the Public or Union Libraries that fall under the Southern Ontario Library Service region?

The library name was selected along with the sum of provincial and local funding to find out the total government funding received by the Public or Union Libraries in the Southern Ontario Region.
```sql
SELECT library_name, SUM(f.provincial + f.local) as total_gov_funding,
city, postal_code
FROM locations as l
INNER JOIN libraries as lib
ON l.location_id = lib.location_id
INNER JOIN fundings as f
ON lib.library_id = f.library_id
WHERE service_type = 'Public or Union Library'
GROUP BY library_name, city, postal_code, ols_region
HAVING ols_region = 'Southern Ontario Library Service'
ORDER BY total_gov_funding;
```

##### Insights
- Ottawa, the capital city, receives the maximum government funding for its library. It could be so because the library is situated in the capital city of Canada.
- The least government funding is received by Head, Clara & Mara, which is located in the city of Stonecliffe.
- Kitchener Public Library ranks among the top 10 properly funded libraries.

### Create Views
Three views were created to show library information, catalogue items available at each library and for quick future analysis of funding and libraries.

```sql
/*Create View 1*/
/*View to show the library information*/
CREATE VIEW lib_info
AS (SELECT library_number, library_name, website, service_type, ols_region
   FROM libraries);
```
```sql
/*Create View 2*/
/*View to show catalogue items available at each library*/
CREATE VIEW lib_items
AS(SELECT library_name, print_title, print_volume, ebook_title, ebook_copy,
   cd_dvd_title, cd_dvd_copy, audiobook_title, audiobook_copy
	   FROM catalogues);
```
```sql
/*Create View 3*/
/*View to show fundings and libraries*/
CREATE VIEW lib_funding
AS (SELECT l.library_name, l.library_id, provincial, local
   FROM libraries as l
   INNER JOIN fundings as f
   ON l.library_id = f.library_id)
```

### Conclusion
After conducting a detailed analysis using SQL, we came up with 3 major conclusions: 
- Toronto Public Library has the highest number of active cardholders, and it also has the highest number of items from the catalogue, showing a positive relationship between the two. It shows that people going to Toronto Public Library have access to vast items in the catalogue; therefore, this library has the highest number of active cardholders.
- It can also be observed that remote places where there are fewer people accessing the library and a smaller number of items from the catalogue have active cardholders in the range of Very Low, and some places have no cardholders due to a lack of facilities available for the use.
- In terms of government funding received by the library, the library in Ottawa receives the highest amount of provincial and local funding to support the library. 
- The libraries of both the city of Kitchener and Guelph are among the Top 15 libraries in the Southern Ontario Region that receives provincial and local government funding.


